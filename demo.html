<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Lightbox Test</title>
  <style>
    body{font-family:system-ui,Arial;margin:0;background:#fafafa;color:#111}
    .wrap{max-width:1100px;margin:30px auto;padding:0 16px}
    .products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px}
    .product-card{background:#fff;border-radius:10px;padding:12px;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    .product-card img{width:100%;height:150px;object-fit:cover;border-radius:6px;cursor:pointer}
    .product-card h3{margin:8px 0 4px}
    .hint{color:#666;margin-top:12px;font-size:14px}

    /* Lightbox overlay */
    .image-popup{display:none;position:fixed;inset:0;z-index:9999;align-items:center;justify-content:center;
      background:rgba(0,0,0,0.6);backdrop-filter:blur(6px)}
    .image-popup.active{display:flex}
    .image-popup .inner{position:relative;max-width:92%;max-height:90%;display:flex;flex-direction:column;align-items:center}
    .image-popup img{max-width:100%;max-height:80vh;border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
    .close-popup{position:absolute;top:-6px;right:-6px;background:#111;color:#fff;border-radius:50%;width:40px;height:40px;border:none;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center}
    body.modal-open{overflow:hidden}
    /* small animation */
    @keyframes zoomIn{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
    .image-popup img{animation:zoomIn .22s ease}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Lightbox test — click any image</h2>
    <div class="products-grid" id="test-grid">
      <div class="product-card">
        <img src="https://picsum.photos/id/1011/800/600" alt="Product 1" />
        <h3>Product 1</h3>
      </div>
      <div class="product-card">
        <img src="https://picsum.photos/id/1025/800/600" alt="Product 2" />
        <h3>Product 2</h3>
      </div>
      <div class="product-card">
        <img src="https://picsum.photos/id/1027/800/600" alt="Product 3" />
        <h3>Product 3</h3>
      </div>
    </div>
    <p class="hint">Esc to close / click outside / click ✖</p>
  </div>

  <!-- Image Popup -->
  <div id="image-popup" class="image-popup" aria-hidden="true">
    <div class="inner" role="dialog" aria-modal="true">
      <button class="close-popup" aria-label="Close">✖</button>
      <img id="popup-img" src="" alt="Expanded product image">
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM loaded — running lightbox test');

      const thumbs = document.querySelectorAll('.product-card img');
      console.log('thumbnails found:', thumbs.length);

      const popup = document.getElementById('image-popup');
      const popupImg = document.getElementById('popup-img');
      const closeBtn = document.querySelector('.close-popup');

      if (!popup || !popupImg || !closeBtn) {
        console.error('Lightbox elements missing. popup:', !!popup, 'popupImg:', !!popupImg, 'closeBtn:', !!closeBtn);
        return;
      }

      function openPopup(src, alt) {
        popupImg.src = src;
        popupImg.alt = alt || '';
        popup.classList.add('active');
        document.body.classList.add('modal-open');
        popup.setAttribute('aria-hidden','false');
      }

      function closePopup() {
        popup.classList.remove('active');
        popupImg.src = '';
        document.body.classList.remove('modal-open');
        popup.setAttribute('aria-hidden','true');
      }

      thumbs.forEach((img,i) => {
        img.addEventListener('click', (e) => {
          console.log('thumb clicked', i, img.src);
          // if you want higher-res image, use data-large attribute if present:
          const large = img.dataset.large || img.src;
          openPopup(large, img.alt);
        });
      });

      closeBtn.addEventListener('click', closePopup);
      popup.addEventListener('click', (e) => { if (e.target === popup) closePopup(); });
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closePopup(); });

      // safety: log JS errors (helpful debugging)
      window.addEventListener('error', (ev) => console.error('JS ERROR:', ev.message, ev.filename, ev.lineno));
    });
  </script>
</body>
</html>
